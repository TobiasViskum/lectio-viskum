"use strict";exports.id=952,exports.ids=[952],exports.modules={87286:(e,t,s)=>{s.d(t,{getFetchCookie:()=>getFetchCookie});var a=s(64734);function getFetchCookie(){let e=new a.default.toughCookie.CookieJar,t=(0,a.default)(fetch,e);return{fetchCookie:t,cookieJar:e}}},3570:(e,t,s)=>{s.d(t,{getAssignmentsPage:()=>getAssignmentsPage});var a=s(47151),i=s(98191),n=s(63509),l=s(21746);async function getAssignmentsPage({lectioCookies:e,schoolCode:t}){let s=await (0,i.getAuthenticatedPage)({lectioCookies:e,schoolCode:t,page:"assignments"});if(null===s||"Not authenticated"===s||"Forbidden access"===s||"Invalid school"===s)return s;let r=s.$,o=s.fetchCookie,c=r("input#__VIEWSTATEX").val(),d=r("input#__EVENTVALIDATION").val(),u=r('input[name="masterfootervalue"]').val();if(!c||!d||!u)return null;{let e=(0,n.getAssignmentsForm)({__VIEWSTATEX:c,__EVENTVALIDATION:d,masterFooterValue:u}),t=(0,l.getLectioProps)(),s=await o("https://www.lectio.dk/lectio/243/OpgaverElev.aspx",{method:"POST",body:e,headers:{Cookie:t.lectioCookies}}).then(async e=>{try{let t=await e.text();if(t.includes("Log ind"))return"Not authenticated";if(t.includes("Der opstod en ukendt fejl"))return null;return{$:(0,a.load)(t),fetchCookie:o}}catch{return null}});return s}}},93390:(e,t,s)=>{s.d(t,{getAuthenticatedPage:()=>getAuthenticatedPage});var a=s(47151),i=s(87286),n=s(90479),l=s(79912);async function getAuthenticatedPage({page:e,specificPage:t,lectioCookies:s,schoolCode:r}){let o="";e?o=(0,n.getPageFromMap)({page:e}):t&&(o=t);let{fetchCookie:c}=(0,i.getFetchCookie)(),d=await c(`https://www.lectio.dk/lectio/${r}/${o}`,{method:"GET",headers:{Cookie:s}}).then(async e=>{try{let t=await e.text();if(t.includes("Log ind"))return"Not authenticated";if(t.includes("Der opstod en ukendt fejl")){let e=await (0,l.getSchoolBySchoolCode)({schoolCode:r});if(null===e)return"Invalid school";return null}if(t.includes("Server Error"))return"Forbidden access";return{$:(0,a.load)(t),fetchCookie:c}}catch{return null}}).catch(e=>null);return d}},62802:(e,t,s)=>{s.d(t,{getBasicPage:()=>getBasicPage});var a=s(47151);let i={school:"https://www.lectio.dk/lectio/login_list.aspx"};async function getBasicPage({page:e}){let t=i[e],s=await fetch(t,{method:"GET"}).then(async e=>{try{let t=await e.text();if(t.includes("Der opstod en ukendt fejl"))return null;return(0,a.load)(t)}catch{return null}}).catch(e=>null);return s}},63509:(e,t,s)=>{s.d(t,{getAssignmentsForm:()=>getAssignmentsForm});function getAssignmentsForm({__VIEWSTATEX:e,__EVENTVALIDATION:t,masterFooterValue:s}){let a=new FormData;return a.append("time","0"),a.append("__EVENTTARGET","s$m$Content$Content$CurrentExerciseFilterCB"),a.append("__EVENTARGUMENT",""),a.append("__LASTFOCUS",""),a.append("__SCROLLPOSITION",""),a.append("__VIEWSTATEX",e),a.append("__VIEWSTATEY_KEY",""),a.append("__VIEWSTATE",""),a.append("__VIEWSTATEENCRYPTED",""),a.append("__EVENTVALIDATION",t),a.append("s$m$ChooseTerm$term","2023"),a.append("s$m$searchinputfield",""),a.append("s$m$Content$Content$ShowHoldElementDD",""),a.append("s$m$Content$Content$ShowThisTermOnlyCB","on"),a.append("masterfootervalue",s),a.append("LectioPostbackId",""),a}},59392:(e,t,s)=>{s.d(t,{getLoginForm:()=>getLoginForm});function getLoginForm({__VIEWSTATEX:e,__EVENTVALIDATION:t,masterFooterValue:s,username:a,password:i}){let n=new FormData;return n.append("time","0"),n.append("__EVENTTARGET","m$Content$submitbtn2"),n.append("__EVENTARGUMENT",""),n.append("__LASTFOCUS",""),n.append("__SCROLLPOSITION",""),n.append("__VIEWSTATEX",e),n.append("__VIEWSTATEY_KEY",""),n.append("__VIEWSTATE",""),n.append("__EVENTVALIDATION",t),n.append("m$Content$username",a),n.append("m$Content$password",i),n.append("masterfootervalue",s),n.append("LectioPostbackId",""),n}},98191:(e,t,s)=>{s.d(t,{getAuthenticatedPage:()=>a.getAuthenticatedPage,getBasicPage:()=>i.getBasicPage});var a=s(93390),i=s(62802)},90479:(e,t,s)=>{s.d(t,{getPageFromMap:()=>getPageFromMap});function getPageFromMap({page:e}){return({front:"forside.aspx",schedule:"SkemaNy.aspx","studyPlan-calender":"studieplan.aspx","studyPlan-educationDescription":"studieplan/undervisningsbeskrivelse.aspx","studyPlan-studyDirection":"studieretningElevValg.aspx","studyPlan-elective":"studieretningValgfag.aspx","absence-overview":"subnav/fravaerelev.aspx","absence-reasons":"subnav/fravaerelev_fravaersaarsager.aspx",assignments:"OpgaverElev.aspx",homework:"material_lektieoversigt.aspx","grades-overview":"grades/grade_report.aspx","grades-messages":"grades/grade_karakterblad.aspx","borrowed-books":"BD/UserReservations.aspx",questionnaire:"spoergeskema/spoergeskema_rapport.aspx","messages-newest":"beskeder2.aspx?selectedfolderid=-70","messages-unread":"beskeder2.aspx?selectedfolderid=-40","messages-all":"beskeder2.aspx?selectedfolderid=-30","messages-personal":"beskeder2.aspx?selectedfolderid=-10","messages-deleted":"beskeder2.aspx?selectedfolderid=-60","student-by-credentials":"DokumentOversigt.aspx?folderid=S53701992282__",teachers:"subnav/members.aspx?holdelementid=35338545824&showteachers=1&showstudents=1&reporttype=classpicture"})[e]}},81955:(e,t,s)=>{s.d(t,{getAllSchools:()=>getAllSchools});var a=s(98191);async function getAllSchools(){let e=await (0,a.getBasicPage)({page:"school"});if(null===e)return e;let t=e("#schoolsdiv > div > a").map((t,s)=>{let a={schoolCode:"",name:""},i=e(s),n=i.attr("href"),l=i.text();return n&&(a.schoolCode=n.match(/[0-9]+/)[0],a.name=l),a}).get();return 0===t.length?"No data":t=t.filter(e=>"Vis alle skoler"!==e.name)}},51368:(e,t,s)=>{s(93390)},73543:(e,t,s)=>{s.d(t,{getAssignment:()=>getAssignment,titleMap:()=>o});var a=s(98191),i=s(89608),n=s(8738),l=s(7754),r=s(11998);let o={"Opgavetitel:":"title","Opgavebeskrivelse:":"documents","Opgavenote:":"note","Hold:":"class","Karakterskala:":"gradeSystem","Ansvarlig:":"teacher","Elevtid:":"studentTime","Afleveringsfrist:":"dueTo","I undervisningsbeskrivelse:":"inTeachingDescription"};async function getAssignment({lectioCookies:e,schoolCode:t,href:s}){let o=await (0,a.getAuthenticatedPage)({lectioCookies:e,schoolCode:t,specificPage:s});if("Not authenticated"===o||"Forbidden access"===o||"Invalid school"===o||null===o)return o;let c=o.$,d={studentName:"",title:"",documents:[],description:[],subject:"",class:"",gradeSystem:"",teacher:{name:"",initials:"",teacherId:"",imgSrc:"",imgUrl:""},studentTime:0,dueTo:"",inTeachingDescription:!1,awaiter:"",status:"",absence:"",finished:!1,grade:"",gradeNote:"",studentNote:"",submits:[]},u=c("#MainTitle").text().match(/Eleven ([a-zæøå ]+)\(/i);u&&(d.studentName=u[1].trim()),(0,n.setInformationProps)(c,d),(0,l.setAdditionalProps)(c,d),(0,r.setSubmitProps)(c,d),d.submits=d.submits.reverse();let g=await (0,i.getTeacherByInitials)({lectioCookies:e,schoolCode:t,initials:d.teacher.initials});return"object"==typeof g&&null!==g&&(d.teacher=g),d}},7754:(e,t,s)=>{s.d(t,{setAdditionalProps:()=>setAdditionalProps});function setAdditionalProps(e,t){e("table#m_Content_StudentGV > tbody > tr:nth-child(2) > td").each((s,a)=>{let i=e(a);if(2===s){let e=i.text()||"Ingen";t.awaiter=e}else if(3===s){let e=i.find("span").text().split("/"),s=e[0].trim().replace("Ikke aflev.","Ikke afleveret"),a=e[1].trim().split(" ")[1];t.status=s,t.absence=a}else if(4===s){let e=i.find("span > input").attr("checked");e&&"checked"===e&&(t.finished=!0)}else if(5===s){let e=i.text().trim();t.grade=e}else if(6===s){let e=i.text().trim();t.gradeNote=e}else if(7===s){let e=i.text().trim();t.studentNote=e}})}},8738:(e,t,s)=>{s.d(t,{setInformationProps:()=>setInformationProps});var a=s(938),i=s(73543);function setInformationProps(e,t){e("div#m_Content_registerAfl_pa > table > tbody > tr").map((s,n)=>{let l=e(n),r=l.find("td"),o=i.titleMap[l.find("th").text()];if("title"===o)t.title=r.find("span").text();else if("documents"===o)r.find("a").each((s,a)=>{let i=e(a),n=i.text().trim(),l=n.split("."),[r,...o]=l[l.length-1].split(" ");r=`.${r}`;let c=o.join(" ");c=` ${c}`||"",l.pop();let d=[[...l].join("."),c,r].join(""),u=t.documents.push({name:d,href:""}),g=i.attr("href");g&&(t.documents[u-1].href=g)});else if("note"===o){t.description=r.text().split("\n");for(let e=0;e<t.description.length;e++)t.description[e]=t.description[e].replace(/\s{2,}/g," ")}else if("class"===o)t.subject=(0,a.getSubjectName)(r.find("span").text()),t.class=r.find("span").text().split(" ")[0];else if("gradeSystem"===o)t.gradeSystem=r.find("span").text();else if("teacher"===o){let e=r.find("span").text().split(" ("),s=e[0],a=e[1].replace(")","");t.teacher.name=s,t.teacher.initials=a}else if("studentTime"===o){let e=r.find("span").text().split(" ")[0];isNaN(Number(e))||(t.studentTime=Number(e))}else if("dueTo"===o){let e=r.text();t.dueTo=e}else if("inTeachingDescription"===o){let e="Ja"===r.text();t.inTeachingDescription=e}})}},11998:(e,t,s)=>{s.d(t,{setSubmitProps:()=>setSubmitProps});function setSubmitProps(e,t){e("#m_Content_RecipientGV > tbody > tr").each((s,a)=>{let i=e(a);i.text().includes("Der er ingen indl\xe6g!")||(0!==s&&t.submits.push({time:"",submitter:"",comment:"",document:{name:"",href:""}}),i.find("td").each((a,i)=>{let n=e(i);if(0===a){let e=n.text();t.submits[s-1].time=e}else if(1===a){let e=n.find("span").text();t.teacher.initials.toLowerCase()===e.toLowerCase()?t.submits[s-1].submitter=t.teacher.name:t.submits[s-1].submitter=e}else if(2===a){let e=n.text();t.submits[s-1].comment=e}else if(3===a){let e=n.find("span > a"),a=e.attr("href");a&&(t.submits[s-1].document.name=e.text(),t.submits[s-1].document.href=a)}}))})}},91339:(e,t,s)=>{s.d(t,{getAssignmentProps:()=>getAssignmentProps});var a=s(938);function getAssignmentProps(e){let t=e.find("td:first-child > span").text(),s=e.find("td:nth-child(2) > span").text(),i=(0,a.getSubjectName)(s),n=e.find("td:nth-child(3) > a").text(),l=e.find("td:nth-child(4)").text(),r=e.find("td:nth-child(5)").text(),o=""!==e.find("td:nth-child(6) > span").text()?e.find("td:nth-child(6) > span").text():e.find("td:nth-child(6)").text(),c=e.find("td:nth-child(7)").text().replace("&nbsp;","").replace(" ","")||"0%",d=e.find("td:nth-child(8)").text()||"Ingen",u=e.find("td:nth-child(9)").text(),g=e.find("td:nth-child(10)").text(),m=e.find("td:nth-child(11)").text();s=s.split(" ")[0];let h=["https://lectio.dk",e.find("td:nth-child(3) > a").attr("href")].join("");return h=h.replace(/https:\/\/lectio.dk\/lectio\/[0-9]+\//,"").replace(/&prevurl=.*/,""),new URLSearchParams([s,t,n].join("").replace(/[!?:()\/,.'"+ ]/g,"").replaceAll("\xe6","ae").replaceAll("\xf8","oe").replaceAll("\xe5","aa").replaceAll("\xc6","Ae").replaceAll("\xd8","Oe").replaceAll("\xc5","Aa").replaceAll("\xdf","ss").replaceAll("\xe4","a").replaceAll("\xf6","o").replaceAll("\xfc","u").replaceAll("\xc4","a").replaceAll("\xd6","o").replaceAll("\xdc","u").replaceAll("\xe9","e").replaceAll("\xc9","E")).toString().slice(0,-1),{week:t,class:s,href:h,subject:i,title:n,dueTo:l,studentTime:r,description:u,status:o,absence:c,awaiter:d,grade:g,gradeNote:m,id:h.split("exerciseid=")[1]}}},2272:(e,t,s)=>{s.d(t,{getAssignments:()=>getAssignments});var a=s(3570),i=s(91339);async function getAssignments({lectioCookies:e,schoolCode:t}){let s=await (0,a.getAssignmentsPage)({lectioCookies:e,schoolCode:t});if("Not authenticated"===s||"Forbidden access"===s||"Invalid school"===s||null===s)return s;let n=s.$,l=n("#s_m_Content_Content_ExerciseGV > tbody > tr:not(:first-child)").map((e,t)=>{let s=n(t),a=(0,i.getAssignmentProps)(s);return a}).get();return 0===l.length?"No data":l}},57329:(e,t,s)=>{s(98191)},18694:(e,t,s)=>{s.d(t,{getIsAuthenticated:()=>getIsAuthenticated});var a=s(47151),i=s(59392),n=s(64734),l=s(79912);async function getIsAuthenticated({username:e,password:t,schoolCode:s}){let r="https://www.lectio.dk/lectio",o=new n.default.toughCookie.CookieJar,c=(0,n.default)(fetch,o),d=await c(`${r}/${s}/login.aspx`).then(async s=>{try{let n=await s.text(),l=(0,a.load)(n),r=l("input#__VIEWSTATEX").val(),o=l("input#__EVENTVALIDATION").val(),c=l('input[name="masterfootervalue"]').val();if(r&&o&&c)return(0,i.getLoginForm)({__VIEWSTATEX:r,__EVENTVALIDATION:o,masterFooterValue:c,username:e,password:t});return null}catch{return null}}).catch(e=>null);if(null===d)return null;let u=await c(`${r}/${s}/login.aspx`,{method:"POST",body:d}).then(async e=>{let t=await e.text();if(t.includes("Log ind"))return{isAuthenticated:!1,lectioCookies:"",studentId:""};if(t.includes("Der opstod en ukendt fejl")){let e=await (0,l.getSchoolBySchoolCode)({schoolCode:s});if(null===e)return"Invalid school"}else{let e=(0,a.load)(t),s="",i=e("#s_m_HeaderContent_MainTitle").attr("data-lectiocontextcard");i&&(s=i.replace("S",""));let n=o.getCookiesSync("https://www.lectio.dk"),l=null,r=null;try{l=n.find(e=>"lectiogsc"===e.key),r=n.find(e=>"ASP.NET_SessionId"===e.key)}catch{}if(l&&r){let e=new Date().toString().replace(/\(.*\)/,"(Central European Summer Time)"),t=encodeURI(e),a="";return{isAuthenticated:!0,lectioCookies:a+=`ASP.NET_SessionId=${r.value};lectiogsc=${l.value};LastAuthenticatedPageLoad=${t};`,studentId:s}}}return null}).catch(e=>null);return u}},5800:(e,t,s)=>{s(93390),s(47151),s(98191)},61045:(e,t,s)=>{s.d(t,{getClass:()=>getClass});function getClass(e){let t=/Hold: ([a-zæøå0-9. ()-]+(, [a-zæøå0-9. ()-]+)*)/i,s=e.search(t),a=e.match(t);if(-1!==s&&a){let t=a[0].length,i=e.substring(s+6,s+t).replace("Alle 1. G. elever","1.G").replace("Alle 2. G. elever","2.G").replace("Alle 3. G. elever","3.G").replace("Alle 4. G. elever","4.G").replace("Alle L\xe6rere","Alle l\xe6rere").replace(" Udl\xe5n af lokaler",""),n=i.split(/ [a-z]{2,3},/gi);return n.forEach((e,t)=>{n[t]=n[t].trim(),n[t].split(", ").length>1&&(n[t].split(", ").forEach(e=>{n.push(e.trim())}),n.splice(t,1))}),n.forEach((e,t)=>{n[t]=n[t].trim()}),n}return[""]}},15107:(e,t,s)=>{s.d(t,{getClassroom:()=>getClassroom});function getClassroom(e){let t=e.split("\n"),s=t.find(e=>e.includes("Lokale"));if(s){let e=s.split(": ")[1].split(", ");return e}return[""]}},53406:(e,t,s)=>{s.d(t,{getSubject:()=>getSubject});var a=s(938),i=s(46818);function getSubject(e){if((0,i.getTitle)(e).includes("Lektiecaf\xe9")){let t=e.match(/Lektiecafé \(([a-z]+)\/([a-z]+)\)/);if(t){let e=(0,a.getSubjectName)("-"+t[1]);3===t[1].length&&""===e&&(e=(0,a.getSubjectName)(t[1][0]+t[1][1]));let s=(0,a.getSubjectName)("-"+t[2]);return 3===t[2].length&&""===s&&(s=(0,a.getSubjectName)(t[2][0]+t[2][1])),[e,s]}return[""]}let t=/Hold: ([a-zæøå0-9. ()-]+(, [a-zæøå0-9. ()-]+)*)/i,s=e.search(t),n=e.match(t);if(-1!==s&&n){let t=n[0].length,i=e.substring(s+6,s+t);if(i.split(", ").length>3)return[""];let l=(0,a.getSubjectName)(i);return[l]}return[""]}},20350:(e,t,s)=>{s.d(t,{getTeachers:()=>getTeachers});function getTeachers(e){let t=/Lærer(e)?: ([a-zæøå ()-]+(, [a-zæøå ()-]+)*)/i,s=e.search(t),a=e.match(t);if(-1!==s&&a){let t=a[0].length,i=e.includes("L\xe6rere:")?8:7,n=e.substring(s+i,s+t);if(n.includes("(")&&n.includes(")")){let e=n.split(" (");return[{name:e[0],initials:e[1].replace(")",""),teacherId:"",imgUrl:"",imgSrc:""}]}{let e=n.split(", "),t=[];return e.forEach(e=>{t.push({name:"",initials:e,teacherId:"",imgSrc:"",imgUrl:""})}),t}}return[{name:"",initials:"",teacherId:"",imgSrc:"",imgUrl:""}]}},78535:(e,t,s)=>{s.d(t,{getTime:()=>getTime});function getTime(e,t){let s=e.split("\n"),a=/([0-9]{1,2}:[0-9]{1,2} (-|til) [0-9]{1,2}:[0-9]{1,2})/i,i=/([0-9\/-]+ [0-9]{1,2}:[0-9]{1,2} (-|til) [0-9\/-]+ [0-9]{1,2}:[0-9]{1,2})/i,n="",l=0;for(let e=0;e<s.length;e++){let t=s[e],r=t.match(a),o=t.match(i);if(r){n=r[1],l=1;break}if(o){n=o[1],l=2;break}}if(""===n)return{startDate:new Date(1970),endDate:new Date(1970)};let r=new Date(1970);if(1===l){let e=n.split(" "),s=e[0].split(":"),a={hours:-1,minutes:-1};isNaN(Number(s[0]))||isNaN(Number(s[1]))||(a.hours=Number(s[0]),a.minutes=Number(s[1]));let i=e[2].split(":"),l={hours:-1,minutes:-1};if(isNaN(Number(i[0]))||isNaN(Number(i[1]))||(l.hours=Number(i[0]),l.minutes=Number(i[1])),-1!==t.year&&-1!==t.year&&-1!==a.hours&&-1!==a.minutes&&-1!==l.hours&&-1!==l.minutes){r=new Date(t.year,0,1);let e=(t.week-1)*7;r.setDate(r.getDate()+e);let s=0;for(;r.getDay()!==t.day+1&&(s++,r.setDate(r.getDate()+1),!(s>=7)););let i=new Date(r);i.setHours(a.hours),i.setMinutes(a.minutes);let n=new Date(r);return n.setHours(l.hours),n.setMinutes(l.minutes),{startDate:i,endDate:n}}}else if(2===l){let e=n.split(" "),t=e[0].split(/(\/|-)/),s=e[1].split(":"),a=Number(t[0]),i=Number(t[2]),l=Number(t[4]),r=Number(s[0]),o=Number(s[1]),c=e[3].split(/(\/|-)/),d=e[4].split(":"),u=Number(c[0]),g=Number(c[2]),m=Number(c[4]),h=Number(d[0]),p=Number(d[1]),f=!isNaN(a)&&!isNaN(i)&&!isNaN(l)&&!isNaN(r)&&!isNaN(o),k=!isNaN(u)&&!isNaN(g)&&!isNaN(m)&&!isNaN(h)&&!isNaN(p);if(f&&k){let e=new Date(l,i-1,a,r,o),t=new Date(m,g-1,u,h,p);return{startDate:e,endDate:t}}}return{startDate:new Date(1970),endDate:new Date(1970)}}},46818:(e,t,s)=>{s.d(t,{getTitle:()=>getTitle});var a=s(31493);function getTitle(e){let t=e.split("\n"),s=t[0];return((t[0].includes("Aflyst!")||t[0].includes("\xc6ndret!"))&&(s=t[1]),s.includes("Aflyst!")||s.includes("\xc6ndret!")||/([0-9:]+ [-|til] [0-9:]+)/i.test(s)||/([0-9\/-]+ [0-9:]+ [-|til] [0-9\/-]+ [0-9:]+)/i.test(s))?"":s.includes("Lektiecaf\xe9")?s.split(" ")[0]:(0,a.capitalizeFirstLetter)(s)}},23611:(e,t,s)=>{s.d(t,{getSchedule:()=>getSchedule});var a=s(98191),i=s(61045),n=s(15107),l=s(53406),r=s(20350),o=s(78535),c=s(46818);async function getSchedule({lectioCookies:e,week:t,year:s,schoolCode:d,teacherId:u,studentId:g}){let m=`SkemaNy.aspx?week=${t.toString()+s.toString()}`;u?m=`SkemaNy.aspx?week=${t+s}&laererid=${u}`:g&&(m=`SkemaNy.aspx?week=${t+s}&elevid=${u}`);let h=isNaN(Number(t))?-1:Number(t),p=isNaN(Number(s))?-1:Number(s),f=await (0,a.getAuthenticatedPage)({lectioCookies:e,schoolCode:d,specificPage:m});if(null===f||"Not authenticated"===f||"Forbidden access"===f||"Invalid school"===f)return f;let k=f.$,b=k(".s2skemabrikcontainer.lec-context-menu-instance").map((e,t)=>{let s=k(t),a=s.find("a[data-additionalinfo]").map((e,t)=>{let s=k(t),a="",d=["https://lectio.dk",s.attr("href")].join(""),u=d.match(/absid=([0-9]+)/i),g=s.attr("data-additionalinfo"),m="normal";u&&g&&(m=g.includes("\xc6ndret!")?"changed":g.includes("Aflyst!")?"cancelled":"normal",a=u[1]);let f={id:"",status:"normal",time:{startDate:new Date(1970),endDate:new Date(1970)},teachers:[],classrooms:[""],classes:[],subjects:[],title:"",hasNote:!1,hasHomework:!1,hasOtherContent:!1,hasPresentation:!1,overlappingLessons:0};return g&&(f.id=a,f.status=m,f.time=(0,o.getTime)(g,{week:h,year:p,day:e}),f.teachers=(0,r.getTeachers)(g),f.classrooms=(0,n.getClassroom)(g),f.classes=(0,i.getClass)(g),f.subjects=(0,l.getSubject)(g),f.title=(0,c.getTitle)(g),f.hasNote=g.includes("Note:"),f.hasHomework=g.includes("Lektier:"),f.hasOtherContent=g.includes("\xd8vrigt indhold:"),f.hasPresentation=g.includes("Aktiviteten har en pr\xe6sentation.")),1===f.subjects.length&&1===f.classes.length&&f.subjects[0]===f.classes[0]&&(f.classes=[""]),f}).get();if(a.forEach((e,t)=>{a.forEach((s,i)=>{let n=e.time.startDate,l=e.time.endDate,r=n.getHours()+n.getMinutes()/60,o=l.getHours()+l.getMinutes()/60,c=s.time.startDate,d=c.getHours()+c.getMinutes()/60;t!==i&&(r===d?a[i].overlappingLessons+=1:d>r&&d<o&&(a[i].overlappingLessons+=1))})}),a.sort((e,t)=>t.time.startDate.getTime()-e.time.startDate.getTime()||t.time.endDate.getTime()-e.time.endDate.getTime()),e<=4)return{lessons:a,notes:[""]}}).get();if(0===b.length)return"No data";let A=!0;for(let e=0;e<b.length;e++){let t=b[e];if(0!==t.lessons.length){A=!1;break}}return A?"No data":b}},79912:(e,t,s)=>{s.d(t,{getSchoolBySchoolCode:()=>getSchoolBySchoolCode});var a=s(89608);async function getSchoolBySchoolCode({schoolCode:e}){let t=await (0,a.getAllSchools)();if("No data"===t)return"No data";if(null===t)return null;let s=t.find(t=>t.schoolCode===e);return void 0===s?null:s}},15370:(e,t,s)=>{s.d(t,{getStudentByCredentials:()=>getStudentByCredentials});var a=s(98191);async function getStudentByCredentials({lectioCookies:e,schoolCode:t}){let s=await (0,a.getAuthenticatedPage)({lectioCookies:e,schoolCode:t,page:"student-by-credentials"});if(null===s||"Not authenticated"===s||"Forbidden access"===s||"Invalid school"===s)return s;let i=s.$,n=s.fetchCookie,l=["https://lectio.dk",i("img#s_m_HeaderContent_picctrlthumbimage").attr("src"),"&fullsize=1"].join(""),r=await n(l,{method:"GET",headers:{Cookie:e}}).then(async e=>{try{let t=await e.arrayBuffer(),s=e.headers.get("content-type"),a=Buffer.from(t).toString("base64"),i=`data:${s};base64,${a}`;return i}catch{return null}}).catch(e=>null),o=i("div#s_m_HeaderContent_MainTitle[data-lectiocontextcard]").attr("data-lectiocontextcard");o&&(o=o.replace("S",""));let c=i("div#s_m_HeaderContent_MainTitle > span.ls-hidden-smallscreen").text(),d="",u="",g=c.match(/Eleven ([a-z0-9 ]+), /i),m=c.match(/Eleven [a-z0-9 ]+, ([a-z0-9-]+) /i);return g&&(d=g[1]),m&&(u=m[1]),{name:d,studentClass:u,studentId:o||"",imgUrl:l,imgSrc:r}}},31957:(e,t,s)=>{s.d(t,{getTeacherByInitials:()=>getTeacherByInitials});var a=s(98191);async function getTeacherByInitials({lectioCookies:e,initials:t,schoolCode:s}){let i=await (0,a.getAuthenticatedPage)({page:"teachers",lectioCookies:e,schoolCode:s});if("Not authenticated"===i||"Forbidden access"===i||"Invalid school"===i||null===i)return i;let n=i.$,l=i.fetchCookie,r=n("span.classpicture").map((e,t)=>{let s={name:"",initials:"",teacherId:"",imgUrl:"",imgSrc:""},a=n(t),i=a.find("> span > span"),l=i.text(),r=i.attr("data-lectiocontextcard");l&&r&&(s.name=l.split(" (")[0],s.initials=l.split(" (")[1].replace(")",""),s.teacherId=r.replace("T",""));let o=a.find("img").attr("src");if(o){let e=["https://lectio.dk",o].join("");s.imgUrl=e}return s}).get();if(0===r.length)return"No data";let o=r.find(e=>e.initials.toLowerCase()===t.toLowerCase());if(void 0===o)return"No data";let c=await l(o.imgUrl,{method:"GET",headers:{Cookie:e}}).then(async e=>{try{let t=await e.arrayBuffer(),s=e.headers.get("content-type"),a=Buffer.from(t).toString("base64"),i=`data:${s};base64,${a}`;return i}catch{return null}}).catch(e=>null);return c&&(o.imgSrc=c),o}},89608:(e,t,s)=>{s.d(t,{getAllSchools:()=>l.getAllSchools,getAssignments:()=>a.getAssignments,getSchedule:()=>i.getSchedule,getTeacherByInitials:()=>n.getTeacherByInitials});var a=s(2272),i=s(23611);s(51368);var n=s(31957);s(57329),s(5800);var l=s(81955)},938:(e,t,s)=>{function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function getSubjectName(e){let t=e.toLowerCase().trimStart();if(t.includes("skolepulje"))return t;if(t.includes("alle")||t.split(", ").length>1)return"";if(t.includes("fy \xf8v"))return"Fysik\xf8velse";if(t.includes("ke \xf8v"))return"Kemi\xf8velse";if(/ mc|-mc|mc-|mc /.test(t)){let e=capitalizeFirstLetter(t.replace(/mc [0-9]+/i,"").trimStart());return e}if(/ mk|-mk|mk-|mk /.test(t)){let e=capitalizeFirstLetter(t.replace(/mk [0-9]+/i,"").trimStart());return e}return/ fy|-fy|fy-/.test(t)?"Fysik":/ ke|-ke|ke-/.test(t)?"Kemi":/ hi|-hi|hi-/.test(t)?"Historie":/ en|-en|en-/.test(t)?"Engelsk":/ da|-da|da-/.test(t)?"Dansk":/ if|-if|if-/.test(t)?"Informatik":/ ma|-ma|ma-/.test(t)?"Matematik":/ id|-id|id-/.test(t)?"Idr\xe6t":/ sa|-sa|sa-/.test(t)?"Samfundsfag":/ ty|-ty|ty-/.test(t)?"Tysk":/ bt|-bt|bt-/.test(t)?"Bioteknologi":/ la|-la|la-/.test(t)?"Latin":/ ap alm|-ap alm|ap alm-/.test(t)?"Almen sprogforst\xe5else":/ de|-de|de-/.test(t)?"Design":/ mu|-mu|mu-/.test(t)?"Musik":/ bi|-bi|bi-/.test(t)?"Biologi":/ ol|-ol|ol-/.test(t)?"Oldtidskundskab":/ as|-as|as-/.test(t)?"Astronomi":/ bk|-bk|bk-/.test(t)?"Billedkunst":/ bro|-bro|bro-/.test(t)?"Brobygning":/ eø|-eø|eø-/.test(t)?"Erhvervs\xf8konomi":/ fi|-fi|fi-/.test(t)?"Filosofi":/ fr|-fr|fr-/.test(t)?"Fransk":/ me|-me|me-/.test(t)?"Mediefag":/ ng|-ng|ng-/.test(t)?"Naturgeografi":/ ps|-ps|ps-/.test(t)?"Psykologi":/ re|-re|re-/.test(t)?"Religion":/ skr|-skr|skr-/.test(t)?"Skriftlige opgaver":/ sp|-sp|sp-/.test(t)?"Spansk":t}s.d(t,{getSubjectName:()=>getSubjectName})},21746:(e,t,s)=>{s.d(t,{getLectioProps:()=>getLectioProps});var a=s(42998),i=s(69072);function getLectioProps(){let e=(0,a.cookies)(),t=e.get("username"),s=e.get("password"),n=e.get("schoolCode"),l=e.get("lectioCookies"),r=e.get("userId");if(t&&s&&n&&l&&r)return{username:t.value,password:s.value,schoolCode:n.value,lectioCookies:decodeURIComponent(l.value),userId:r.value};(0,i.redirect)("/log-ind?redirected=true")}},39180:(e,t,s)=>{s.d(t,{getAllAssignments:()=>getAllAssignments});var a=s(76655),i=s(89608),n=s(43496),l=s(59839);let getAllAssignments=async e=>{let t=e.userId,s=`${t}-assignments`,r=global.cache.get(s);if(r&&new Date().getTime()<r.expires)return r.data;let o=await (0,i.getAssignments)({lectioCookies:e.lectioCookies,schoolCode:e.schoolCode}),c=(0,a.processResult)(o);(0,n.validateResult)(c);let d="success"===c.status?c.data:null;return d&&global.cache.set(s,{data:d,expires:new Date().getTime()+(0,l.getTimeInMs)({minutes:5})}),d}},95926:(e,t,s)=>{s.d(t,{getAllSchools:()=>getAllSchools});var a=s(89608),i=s(76655);let getAllSchools=async()=>{let e=await (0,a.getAllSchools)(),t=(0,i.processResult)(e),s="success"===t.status?t.data:null;return s}},31663:(e,t,s)=>{s.d(t,{getAssignmentByHref:()=>getAssignmentByHref});var a=s(73543),i=s(76655),n=s(43496),l=s(59839);let getAssignmentByHref=async e=>{let t=`ElevAflevering.aspx?elevid=${e.userId}&exerciseid=${e.assignmentId}`,s=e.userId,r=`${s}-assignments-${e.assignmentId}`,o=global.cache.get(r);if(o&&new Date().getTime()<o.expires)return o.data;let c=await (0,a.getAssignment)({href:t,lectioCookies:e.lectioCookies,schoolCode:e.schoolCode}),d=(0,i.processResult)(c);(0,n.validateResult)(d);let u="success"===d.status?d.data:null;return u&&global.cache.set(r,{data:u,expires:new Date().getTime()+(0,l.getTimeInMs)({minutes:1})}),u}},99328:(e,t,s)=>{s.d(t,{getIsAuthenticated:()=>getIsAuthenticated});var a=s(18694),i=s(76655);let getIsAuthenticated=async e=>{let t=await (0,a.getIsAuthenticated)(e),s=(0,i.processResult)(t),n="success"===s.status?s.data:null;return n}},88874:(e,t,s)=>{s.d(t,{getScheduleByCredentials:()=>getScheduleByCredentials});var a=s(89608),i=s(76655),n=s(43496),l=s(59839);let getScheduleByCredentials=async e=>{let t=e.userId,s=`${t}-schedule-${e.week+e.week}`,r=global.cache.get(s);if(r&&new Date().getTime()<r.expires)return r.data;let o=await (0,a.getSchedule)({week:e.week,year:e.year,schoolCode:e.schoolCode,lectioCookies:e.lectioCookies}),c=(0,i.processResult)(o);(0,n.validateResult)(c);let d="success"===c.status?c.data:null;return d&&global.cache.set(s,{data:d,expires:new Date().getTime()+(0,l.getTimeInMs)({seconds:30})}),d}},67642:(e,t,s)=>{s.d(t,{getSchool:()=>getSchool});var a=s(79912),i=s(76655);let getSchool=async e=>{let t=await (0,a.getSchoolBySchoolCode)({schoolCode:e.schoolCode}),s=(0,i.processResult)(t),n="success"===s.status?s.data:null;return n}},13046:(e,t,s)=>{s.d(t,{getStudentByCredentials:()=>getStudentByCredentials});var a=s(76655),i=s(15370),n=s(43496),l=s(59839);let getStudentByCredentials=async e=>{let t=e.userId,s=`${t}-user`,r=global.cache.get(s);if(r&&new Date().getTime()<r.expires)return r.data;let o=await (0,i.getStudentByCredentials)({schoolCode:e.schoolCode,lectioCookies:e.lectioCookies}),c=(0,a.processResult)(o);(0,n.validateResult)(c);let d="success"===c.status?c.data:null;return d&&global.cache.set(s,{data:d,expires:new Date().getTime()+(0,l.getTimeInMs)({days:1})}),d}},62952:(e,t,s)=>{s.d(t,{lectioAPI:()=>d});var a=s(67642),i=s(95926),n=s(99328),l=s(13046),r=s(88874),o=s(39180),c=s(31663);let d={getSchool:a.getSchool,getAllSchools:i.getAllSchools,getIsAuthenticated:n.getIsAuthenticated,getStudent:{byCredentials:l.getStudentByCredentials},getSchedule:{byCredentials:r.getScheduleByCredentials},getAssignment:{all:o.getAllAssignments,byHref:c.getAssignmentByHref}}},76655:(e,t,s)=>{s.d(t,{processResult:()=>processResult});function processResult(e){return"No data"===e?{status:"success",message:"There was no data",data:[]}:"Forbidden access"===e?{status:"error",message:"There was too many requests to Lectio, so Lectio has blocked this user for a few minutes"}:"Not authenticated"===e?{status:"error",message:"User not authenticated"}:"Invalid school"===e?{status:"error",message:"School doesn't exist"}:null===e?{status:"error",message:"An error happened when trying to get data."}:{status:"success",message:"Successfully retrieved data",data:e}}},43496:(e,t,s)=>{s.d(t,{validateResult:()=>validateResult});var a=s(69072);function validateResult(e){if("error"===e.status){if(e.message.includes("too many requests"))return(0,a.redirect)("/adgang-forbudt");if(e.message.includes("auth"))return(0,a.redirect)("/opdater-adgang")}}},31493:(e,t,s)=>{s.d(t,{capitalizeFirstLetter:()=>capitalizeFirstLetter});function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}},59839:(e,t,s)=>{s.d(t,{getTimeInMs:()=>getTimeInMs});function getTimeInMs({weeks:e=0,days:t=0,hours:s=0,minutes:a=0,seconds:i=0}){let n={week:6048e5,day:864e5,hours:36e5,minutes:6e4,seconds:1e3},l=e*n.week+t*n.day+s*n.hours+a*n.minutes+i*n.seconds;return l}}};