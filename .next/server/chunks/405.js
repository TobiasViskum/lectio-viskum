"use strict";exports.id=405,exports.ids=[405],exports.modules={37798:(e,t,s)=>{s.d(t,{cn:()=>cn});var a=s(96925),i=s(56497);function cn(...e){return(0,i.m)((0,a.W)(e))}},69429:(e,t,s)=>{s.d(t,{t:()=>getLectioProps});var a=s(28913),i=s(28994);function getLectioProps(){let e=(0,a.cookies)(),t=e.get("username"),s=e.get("password"),n=e.get("schoolCode"),l=e.get("lectioCookies"),r=e.get("userId");if(t&&s&&n&&l&&r)return{username:t.value,password:s.value,schoolCode:n.value,lectioCookies:decodeURIComponent(l.value),userId:r.value};(0,i.redirect)("/log-ind?redirected=true")}},34388:(e,t,s)=>{s.d(t,{G:()=>d});var a=s(5465),i=s(84985);function getFetchCookie(){let e=new i.Z.toughCookie.CookieJar,t=(0,i.Z)(fetch,e);return{fetchCookie:t,cookieJar:e}}function getPageFromMap({page:e}){return({front:"forside.aspx",schedule:"SkemaNy.aspx","studyPlan-calender":"studieplan.aspx","studyPlan-educationDescription":"studieplan/undervisningsbeskrivelse.aspx","studyPlan-studyDirection":"studieretningElevValg.aspx","studyPlan-elective":"studieretningValgfag.aspx","absence-overview":"subnav/fravaerelev.aspx","absence-reasons":"subnav/fravaerelev_fravaersaarsager.aspx",assignments:"OpgaverElev.aspx",homework:"material_lektieoversigt.aspx","grades-overview":"grades/grade_report.aspx","grades-messages":"grades/grade_karakterblad.aspx","borrowed-books":"BD/UserReservations.aspx",questionnaire:"spoergeskema/spoergeskema_rapport.aspx","messages-newest":"beskeder2.aspx?selectedfolderid=-70","messages-unread":"beskeder2.aspx?selectedfolderid=-40","messages-all":"beskeder2.aspx?selectedfolderid=-30","messages-personal":"beskeder2.aspx?selectedfolderid=-10","messages-deleted":"beskeder2.aspx?selectedfolderid=-60","student-by-credentials":"DokumentOversigt.aspx?folderid=S53701992282__",teachers:"subnav/members.aspx?holdelementid=35338545824&showteachers=1&showstudents=1&reporttype=classpicture"})[e]}async function getAuthenticatedPage_getAuthenticatedPage({page:e,specificPage:t,lectioCookies:s,schoolCode:i}){let n="";e?n=getPageFromMap({page:e}):t&&(n=t);let{fetchCookie:l}=getFetchCookie(),r=await l(`https://www.lectio.dk/lectio/${i}/${n}`,{method:"GET",headers:{Cookie:s}}).then(async e=>{try{let t=await e.text();if(t.includes("Log ind"))return"Not authenticated";if(t.includes("Der opstod en ukendt fejl")){let e=await getSchoolBySchoolCode({schoolCode:i});if(null===e)return"Invalid school";return null}if(t.includes("Server Error"))return"Forbidden access";return{$:(0,a.zD)(t),fetchCookie:l}}catch{return null}}).catch(e=>null);return r}let n={school:"https://www.lectio.dk/lectio/login_list.aspx"};async function getBasicPage({page:e}){let t=n[e],s=await fetch(t,{method:"GET"}).then(async e=>{try{let t=await e.text();if(t.includes("Der opstod en ukendt fejl"))return null;return(0,a.zD)(t)}catch{return null}}).catch(e=>null);return s}function getAssignmentsForm({__VIEWSTATEX:e,__EVENTVALIDATION:t,masterFooterValue:s}){let a=new FormData;return a.append("time","0"),a.append("__EVENTTARGET","s$m$Content$Content$CurrentExerciseFilterCB"),a.append("__EVENTARGUMENT",""),a.append("__LASTFOCUS",""),a.append("__SCROLLPOSITION",""),a.append("__VIEWSTATEX",e),a.append("__VIEWSTATEY_KEY",""),a.append("__VIEWSTATE",""),a.append("__VIEWSTATEENCRYPTED",""),a.append("__EVENTVALIDATION",t),a.append("s$m$ChooseTerm$term","2023"),a.append("s$m$searchinputfield",""),a.append("s$m$Content$Content$ShowHoldElementDD",""),a.append("s$m$Content$Content$ShowThisTermOnlyCB","on"),a.append("masterfootervalue",s),a.append("LectioPostbackId",""),a}var l=s(69429);async function getAssignmentsPage({lectioCookies:e,schoolCode:t}){let s=await getAuthenticatedPage_getAuthenticatedPage({lectioCookies:e,schoolCode:t,page:"assignments"});if(null===s||"Not authenticated"===s||"Forbidden access"===s||"Invalid school"===s)return s;let i=s.$,n=s.fetchCookie,r=i("input#__VIEWSTATEX").val(),o=i("input#__EVENTVALIDATION").val(),c=i('input[name="masterfootervalue"]').val();if(!r||!o||!c)return null;{let e=getAssignmentsForm({__VIEWSTATEX:r,__EVENTVALIDATION:o,masterFooterValue:c}),t=(0,l.t)(),s=await n("https://www.lectio.dk/lectio/243/OpgaverElev.aspx",{method:"POST",body:e,headers:{Cookie:t.lectioCookies}}).then(async e=>{try{let t=await e.text();if(t.includes("Log ind"))return"Not authenticated";if(t.includes("Der opstod en ukendt fejl"))return null;return{$:(0,a.zD)(t),fetchCookie:n}}catch{return null}});return s}}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function getSubjectName(e){let t=e.toLowerCase().trimStart();if(t.includes("skolepulje"))return t;if(t.includes("alle")||t.split(", ").length>1)return"";if(t.includes("fy \xf8v"))return"Fysik\xf8velse";if(t.includes("ke \xf8v"))return"Kemi\xf8velse";if(/ mc|-mc|mc-|mc /.test(t)){let e=capitalizeFirstLetter(t.replace(/mc [0-9]+/i,"").trimStart());return e}if(/ mk|-mk|mk-|mk /.test(t)){let e=capitalizeFirstLetter(t.replace(/mk [0-9]+/i,"").trimStart());return e}return/ fy|-fy|fy-/.test(t)?"Fysik":/ ke|-ke|ke-/.test(t)?"Kemi":/ hi|-hi|hi-/.test(t)?"Historie":/ en|-en|en-/.test(t)?"Engelsk":/ da|-da|da-/.test(t)?"Dansk":/ if|-if|if-/.test(t)?"Informatik":/ ma|-ma|ma-/.test(t)?"Matematik":/ id|-id|id-/.test(t)?"Idr\xe6t":/ sa|-sa|sa-/.test(t)?"Samfundsfag":/ ty|-ty|ty-/.test(t)?"Tysk":/ bt|-bt|bt-/.test(t)?"Bioteknologi":/ la|-la|la-/.test(t)?"Latin":/ ap alm|-ap alm|ap alm-/.test(t)?"Almen sprogforst\xe5else":/ de|-de|de-/.test(t)?"Design":/ mu|-mu|mu-/.test(t)?"Musik":/ bi|-bi|bi-/.test(t)?"Biologi":/ ol|-ol|ol-/.test(t)?"Oldtidskundskab":/ as|-as|as-/.test(t)?"Astronomi":/ bk|-bk|bk-/.test(t)?"Billedkunst":/ bro|-bro|bro-/.test(t)?"Brobygning":/ eø|-eø|eø-/.test(t)?"Erhvervs\xf8konomi":/ fi|-fi|fi-/.test(t)?"Filosofi":/ fr|-fr|fr-/.test(t)?"Fransk":/ me|-me|me-/.test(t)?"Mediefag":/ ng|-ng|ng-/.test(t)?"Naturgeografi":/ ps|-ps|ps-/.test(t)?"Psykologi":/ re|-re|re-/.test(t)?"Religion":/ skr|-skr|skr-/.test(t)?"Skriftlige opgaver":/ sp|-sp|sp-/.test(t)?"Spansk":t}function getAssignmentProps(e){let t=e.find("td:first-child > span").text(),s=e.find("td:nth-child(2) > span").text(),a=getSubjectName(s),i=e.find("td:nth-child(3) > a").text(),n=e.find("td:nth-child(4)").text(),l=e.find("td:nth-child(5)").text(),r=""!==e.find("td:nth-child(6) > span").text()?e.find("td:nth-child(6) > span").text():e.find("td:nth-child(6)").text(),o=e.find("td:nth-child(7)").text().replace("&nbsp;","").replace(" ","")||"0%",c=e.find("td:nth-child(8)").text()||"Ingen",d=e.find("td:nth-child(9)").text(),u=e.find("td:nth-child(10)").text(),g=e.find("td:nth-child(11)").text();s=s.split(" ")[0];let m=["https://lectio.dk",e.find("td:nth-child(3) > a").attr("href")].join("");return m=m.replace(/https:\/\/lectio.dk\/lectio\/[0-9]+\//,"").replace(/&prevurl=.*/,""),new URLSearchParams([s,t,i].join("").replace(/[!?:()\/,.'"+ ]/g,"").replaceAll("\xe6","ae").replaceAll("\xf8","oe").replaceAll("\xe5","aa").replaceAll("\xc6","Ae").replaceAll("\xd8","Oe").replaceAll("\xc5","Aa").replaceAll("\xdf","ss").replaceAll("\xe4","a").replaceAll("\xf6","o").replaceAll("\xfc","u").replaceAll("\xc4","a").replaceAll("\xd6","o").replaceAll("\xdc","u").replaceAll("\xe9","e").replaceAll("\xc9","E")).toString().slice(0,-1),{week:t,class:s,href:m,subject:a,title:i,dueTo:n,studentTime:l,description:d,status:r,absence:o,awaiter:c,grade:u,gradeNote:g,id:m.split("exerciseid=")[1]}}async function getAssignments({lectioCookies:e,schoolCode:t}){let s=await getAssignmentsPage({lectioCookies:e,schoolCode:t});if("Not authenticated"===s||"Forbidden access"===s||"Invalid school"===s||null===s)return s;let a=s.$,i=a("#s_m_Content_Content_ExerciseGV > tbody > tr:not(:first-child)").map((e,t)=>{let s=a(t),i=getAssignmentProps(s);return i}).get();return 0===i.length?"No data":i}function getClass(e){let t=/Hold: ([a-zæøå0-9. ()-]+(, [a-zæøå0-9. ()-]+)*)/i,s=e.search(t),a=e.match(t);if(-1!==s&&a){let t=a[0].length,i=e.substring(s+6,s+t).replace("Alle 1. G. elever","1.G").replace("Alle 2. G. elever","2.G").replace("Alle 3. G. elever","3.G").replace("Alle 4. G. elever","4.G").replace("Alle L\xe6rere","Alle l\xe6rere").replace(" Udl\xe5n af lokaler",""),n=i.split(/ [a-z]{2,3},/gi);return n.forEach((e,t)=>{n[t]=n[t].trim(),n[t].split(", ").length>1&&(n[t].split(", ").forEach(e=>{n.push(e.trim())}),n.splice(t,1))}),n.forEach((e,t)=>{n[t]=n[t].trim()}),n}return[""]}function getClassroom(e){let t=e.split("\n"),s=t.find(e=>e.includes("Lokale"));if(s){let e=s.split(": ")[1].split(", ");return e}return[""]}var r=s(12979);function getTitle(e){let t=e.split("\n"),s=t[0];return((t[0].includes("Aflyst!")||t[0].includes("\xc6ndret!"))&&(s=t[1]),s.includes("Aflyst!")||s.includes("\xc6ndret!")||/([0-9:]+ [-|til] [0-9:]+)/i.test(s)||/([0-9\/-]+ [0-9:]+ [-|til] [0-9\/-]+ [0-9:]+)/i.test(s))?"":s.includes("Lektiecaf\xe9")?s.split(" ")[0]:(0,r.f)(s)}function getSubject(e){if(getTitle(e).includes("Lektiecaf\xe9")){let t=e.match(/Lektiecafé \(([a-z]+)\/([a-z]+)\)/);if(t){let e=getSubjectName("-"+t[1]);3===t[1].length&&""===e&&(e=getSubjectName(t[1][0]+t[1][1]));let s=getSubjectName("-"+t[2]);return 3===t[2].length&&""===s&&(s=getSubjectName(t[2][0]+t[2][1])),[e,s]}return[""]}let t=/Hold: ([a-zæøå0-9. ()-]+(, [a-zæøå0-9. ()-]+)*)/i,s=e.search(t),a=e.match(t);if(-1!==s&&a){let t=a[0].length,i=e.substring(s+6,s+t);if(i.split(", ").length>3)return[""];let n=getSubjectName(i);return[n]}return[""]}function getTeachers(e){let t=/Lærer(e)?: ([a-zæøå ()-]+(, [a-zæøå ()-]+)*)/i,s=e.search(t),a=e.match(t);if(-1!==s&&a){let t=a[0].length,i=e.includes("L\xe6rere:")?8:7,n=e.substring(s+i,s+t);if(n.includes("(")&&n.includes(")")){let e=n.split(" (");return[{name:e[0],initials:e[1].replace(")",""),teacherId:"",imgUrl:"",imgSrc:""}]}{let e=n.split(", "),t=[];return e.forEach(e=>{t.push({name:"",initials:e,teacherId:"",imgSrc:"",imgUrl:""})}),t}}return[{name:"",initials:"",teacherId:"",imgSrc:"",imgUrl:""}]}function getTime(e,t){let s=e.split("\n"),a=/([0-9]{1,2}:[0-9]{1,2} (-|til) [0-9]{1,2}:[0-9]{1,2})/i,i=/([0-9\/-]+ [0-9]{1,2}:[0-9]{1,2} (-|til) [0-9\/-]+ [0-9]{1,2}:[0-9]{1,2})/i,n="",l=0;for(let e=0;e<s.length;e++){let t=s[e],r=t.match(a),o=t.match(i);if(r){n=r[1],l=1;break}if(o){n=o[1],l=2;break}}if(""===n)return{startDate:new Date(1970),endDate:new Date(1970)};let r=new Date(1970);if(1===l){let e=n.split(" "),s=e[0].split(":"),a={hours:-1,minutes:-1};isNaN(Number(s[0]))||isNaN(Number(s[1]))||(a.hours=Number(s[0]),a.minutes=Number(s[1]));let i=e[2].split(":"),l={hours:-1,minutes:-1};if(isNaN(Number(i[0]))||isNaN(Number(i[1]))||(l.hours=Number(i[0]),l.minutes=Number(i[1])),-1!==t.year&&-1!==t.year&&-1!==a.hours&&-1!==a.minutes&&-1!==l.hours&&-1!==l.minutes){r=new Date(t.year,0,1);let e=(t.week-1)*7;r.setDate(r.getDate()+e);let s=0;for(;r.getDay()!==t.day+1&&(s++,r.setDate(r.getDate()+1),!(s>=7)););let i=new Date(r);i.setHours(a.hours),i.setMinutes(a.minutes);let n=new Date(r);return n.setHours(l.hours),n.setMinutes(l.minutes),{startDate:i,endDate:n}}}else if(2===l){let e=n.split(" "),t=e[0].split(/(\/|-)/),s=e[1].split(":"),a=Number(t[0]),i=Number(t[2]),l=Number(t[4]),r=Number(s[0]),o=Number(s[1]),c=e[3].split(/(\/|-)/),d=e[4].split(":"),u=Number(c[0]),g=Number(c[2]),m=Number(c[4]),h=Number(d[0]),p=Number(d[1]),f=!isNaN(a)&&!isNaN(i)&&!isNaN(l)&&!isNaN(r)&&!isNaN(o),k=!isNaN(u)&&!isNaN(g)&&!isNaN(m)&&!isNaN(h)&&!isNaN(p);if(f&&k){let e=new Date(l,i-1,a,r,o),t=new Date(m,g-1,u,h,p);return{startDate:e,endDate:t}}}return{startDate:new Date(1970),endDate:new Date(1970)}}async function getSchedule({lectioCookies:e,week:t,year:s,schoolCode:a,teacherId:i,studentId:n}){let l=`SkemaNy.aspx?week=${t.toString()+s.toString()}`;i?l=`SkemaNy.aspx?week=${t+s}&laererid=${i}`:n&&(l=`SkemaNy.aspx?week=${t+s}&elevid=${i}`);let r=isNaN(Number(t))?-1:Number(t),o=isNaN(Number(s))?-1:Number(s),c=await getAuthenticatedPage_getAuthenticatedPage({lectioCookies:e,schoolCode:a,specificPage:l});if(null===c||"Not authenticated"===c||"Forbidden access"===c||"Invalid school"===c)return c;let d=c.$,u=d(".s2skemabrikcontainer.lec-context-menu-instance").map((e,t)=>{let s=d(t),a=s.find("a[data-additionalinfo]").map((e,t)=>{let s=d(t),a="",i=["https://lectio.dk",s.attr("href")].join(""),n=i.match(/absid=([0-9]+)/i),l=s.attr("data-additionalinfo"),c="normal";n&&l&&(c=l.includes("\xc6ndret!")?"changed":l.includes("Aflyst!")?"cancelled":"normal",a=n[1]);let u={id:"",status:"normal",time:{startDate:new Date(1970),endDate:new Date(1970)},teachers:[],classrooms:[""],classes:[],subjects:[],title:"",hasNote:!1,hasHomework:!1,hasOtherContent:!1,hasPresentation:!1,overlappingLessons:0};return l&&(u.id=a,u.status=c,u.time=getTime(l,{week:r,year:o,day:e}),u.teachers=getTeachers(l),u.classrooms=getClassroom(l),u.classes=getClass(l),u.subjects=getSubject(l),u.title=getTitle(l),u.hasNote=l.includes("Note:"),u.hasHomework=l.includes("Lektier:"),u.hasOtherContent=l.includes("\xd8vrigt indhold:"),u.hasPresentation=l.includes("Aktiviteten har en pr\xe6sentation.")),1===u.subjects.length&&1===u.classes.length&&u.subjects[0]===u.classes[0]&&(u.classes=[""]),u}).get();if(a.forEach((e,t)=>{a.forEach((s,i)=>{let n=e.time.startDate,l=e.time.endDate,r=n.getHours()+n.getMinutes()/60,o=l.getHours()+l.getMinutes()/60,c=s.time.startDate,d=c.getHours()+c.getMinutes()/60;t!==i&&(r===d?a[i].overlappingLessons+=1:d>r&&d<o&&(a[i].overlappingLessons+=1))})}),a.sort((e,t)=>t.time.startDate.getTime()-e.time.startDate.getTime()||t.time.endDate.getTime()-e.time.endDate.getTime()),e<=4)return{lessons:a,notes:[""]}}).get();if(0===u.length)return"No data";let g=!0;for(let e=0;e<u.length;e++){let t=u[e];if(0!==t.lessons.length){g=!1;break}}return g?"No data":u}async function getTeacherByInitials({lectioCookies:e,initials:t,schoolCode:s}){let a=await getAuthenticatedPage_getAuthenticatedPage({page:"teachers",lectioCookies:e,schoolCode:s});if("Not authenticated"===a||"Forbidden access"===a||"Invalid school"===a||null===a)return a;let i=a.$,n=a.fetchCookie,l=i("span.classpicture").map((e,t)=>{let s={name:"",initials:"",teacherId:"",imgUrl:"",imgSrc:""},a=i(t),n=a.find("> span > span"),l=n.text(),r=n.attr("data-lectiocontextcard");l&&r&&(s.name=l.split(" (")[0],s.initials=l.split(" (")[1].replace(")",""),s.teacherId=r.replace("T",""));let o=a.find("img").attr("src");if(o){let e=["https://lectio.dk",o].join("");s.imgUrl=e}return s}).get();if(0===l.length)return"No data";let r=l.find(e=>e.initials.toLowerCase()===t.toLowerCase());if(void 0===r)return"No data";let o=await n(r.imgUrl,{method:"GET",headers:{Cookie:e}}).then(async e=>{try{let t=await e.arrayBuffer(),s=e.headers.get("content-type"),a=Buffer.from(t).toString("base64"),i=`data:${s};base64,${a}`;return i}catch{return null}}).catch(e=>null);return o&&(r.imgSrc=o),r}async function getAllSchools(){let e=await getBasicPage({page:"school"});if(null===e)return e;let t=e("#schoolsdiv > div > a").map((t,s)=>{let a={schoolCode:"",name:""},i=e(s),n=i.attr("href"),l=i.text();return n&&(a.schoolCode=n.match(/[0-9]+/)[0],a.name=l),a}).get();return 0===t.length?"No data":t=t.filter(e=>"Vis alle skoler"!==e.name)}async function getSchoolBySchoolCode({schoolCode:e}){let t=await getAllSchools();if("No data"===t)return"No data";if(null===t)return null;let s=t.find(t=>t.schoolCode===e);return void 0===s?null:s}function processResult(e){return"No data"===e?{status:"success",message:"There was no data",data:[]}:"Forbidden access"===e?{status:"error",message:"There was too many requests to Lectio, so Lectio has blocked this user for a few minutes"}:"Not authenticated"===e?{status:"error",message:"User not authenticated"}:"Invalid school"===e?{status:"error",message:"School doesn't exist"}:null===e?{status:"error",message:"An error happened when trying to get data."}:{status:"success",message:"Successfully retrieved data",data:e}}let getSchool=async e=>{let t=await getSchoolBySchoolCode({schoolCode:e.schoolCode}),s=processResult(t),a="success"===s.status?s.data:null;return a},getAllSchools_getAllSchools=async()=>{let e=await getAllSchools(),t=processResult(e),s="success"===t.status?t.data:null;return s};function getLoginForm({__VIEWSTATEX:e,__EVENTVALIDATION:t,masterFooterValue:s,username:a,password:i}){let n=new FormData;return n.append("time","0"),n.append("__EVENTTARGET","m$Content$submitbtn2"),n.append("__EVENTARGUMENT",""),n.append("__LASTFOCUS",""),n.append("__SCROLLPOSITION",""),n.append("__VIEWSTATEX",e),n.append("__VIEWSTATEY_KEY",""),n.append("__VIEWSTATE",""),n.append("__EVENTVALIDATION",t),n.append("m$Content$username",a),n.append("m$Content$password",i),n.append("masterfootervalue",s),n.append("LectioPostbackId",""),n}async function getIsAuthenticated({username:e,password:t,schoolCode:s}){let n="https://www.lectio.dk/lectio",l=new i.Z.toughCookie.CookieJar,r=(0,i.Z)(fetch,l),o=await r(`${n}/${s}/login.aspx`).then(async s=>{try{let i=await s.text(),n=(0,a.zD)(i),l=n("input#__VIEWSTATEX").val(),r=n("input#__EVENTVALIDATION").val(),o=n('input[name="masterfootervalue"]').val();if(l&&r&&o)return getLoginForm({__VIEWSTATEX:l,__EVENTVALIDATION:r,masterFooterValue:o,username:e,password:t});return null}catch{return null}}).catch(e=>null);if(null===o)return null;let c=await r(`${n}/${s}/login.aspx`,{method:"POST",body:o}).then(async e=>{let t=await e.text();if(t.includes("Log ind"))return{isAuthenticated:!1,lectioCookies:"",studentId:""};if(t.includes("Der opstod en ukendt fejl")){let e=await getSchoolBySchoolCode({schoolCode:s});if(null===e)return"Invalid school"}else{let e=(0,a.zD)(t),s="",i=e("#s_m_HeaderContent_MainTitle").attr("data-lectiocontextcard");i&&(s=i.replace("S",""));let n=l.getCookiesSync("https://www.lectio.dk"),r=null,o=null;try{r=n.find(e=>"lectiogsc"===e.key),o=n.find(e=>"ASP.NET_SessionId"===e.key)}catch{}if(r&&o){let e=new Date().toString().replace(/\(.*\)/,"(Central European Summer Time)"),t=encodeURI(e),a="";return{isAuthenticated:!0,lectioCookies:a+=`ASP.NET_SessionId=${o.value};lectiogsc=${r.value};LastAuthenticatedPageLoad=${t};`,studentId:s}}}return null}).catch(e=>null);return c}let getIsAuthenticated_getIsAuthenticated=async e=>{let t=await getIsAuthenticated(e),s=processResult(t),a="success"===s.status?s.data:null;return a};async function getStudentByCredentials({lectioCookies:e,schoolCode:t}){let s=await getAuthenticatedPage_getAuthenticatedPage({lectioCookies:e,schoolCode:t,page:"student-by-credentials"});if(null===s||"Not authenticated"===s||"Forbidden access"===s||"Invalid school"===s)return s;let a=s.$,i=s.fetchCookie,n=["https://lectio.dk",a("img#s_m_HeaderContent_picctrlthumbimage").attr("src"),"&fullsize=1"].join(""),l=await i(n,{method:"GET",headers:{Cookie:e}}).then(async e=>{try{let t=await e.arrayBuffer(),s=e.headers.get("content-type"),a=Buffer.from(t).toString("base64"),i=`data:${s};base64,${a}`;return i}catch{return null}}).catch(e=>null),r=a("div#s_m_HeaderContent_MainTitle[data-lectiocontextcard]").attr("data-lectiocontextcard");r&&(r=r.replace("S",""));let o=a("div#s_m_HeaderContent_MainTitle > span.ls-hidden-smallscreen").text(),c="",d="",u=o.match(/Eleven ([a-z0-9 ]+), /i),g=o.match(/Eleven [a-z0-9 ]+, ([a-z0-9-]+) /i);return u&&(c=u[1]),g&&(d=g[1]),{name:c,studentClass:d,studentId:r||"",imgUrl:n,imgSrc:l}}var o=s(28994);function validateResult(e){if("error"===e.status){if(e.message.includes("too many requests"))return(0,o.redirect)("/adgang-forbudt");if(e.message.includes("auth"))return(0,o.redirect)("/opdater-adgang")}}function getTimeInMs({weeks:e=0,days:t=0,hours:s=0,minutes:a=0,seconds:i=0}){let n={week:6048e5,day:864e5,hours:36e5,minutes:6e4,seconds:1e3},l=e*n.week+t*n.day+s*n.hours+a*n.minutes+i*n.seconds;return l}let getStudentByCredentials_getStudentByCredentials=async e=>{let t=e.userId,s=`${t}-user`,a=global.cache.get(s);if(a&&new Date().getTime()<a.expires)return a.data;let i=await getStudentByCredentials({schoolCode:e.schoolCode,lectioCookies:e.lectioCookies}),n=processResult(i);validateResult(n);let l="success"===n.status?n.data:null;return l&&global.cache.set(s,{data:l,expires:new Date().getTime()+getTimeInMs({days:1})}),l},getScheduleByCredentials=async e=>{let t=e.userId,s=`${t}-schedule-${e.week+e.week}`,a=global.cache.get(s);if(a&&new Date().getTime()<a.expires)return a.data;let i=await getSchedule({week:e.week,year:e.year,schoolCode:e.schoolCode,lectioCookies:e.lectioCookies}),n=processResult(i);validateResult(n);let l="success"===n.status?n.data:null;return l&&global.cache.set(s,{data:l,expires:new Date().getTime()+getTimeInMs({seconds:30})}),l},getAllAssignments=async e=>{let t=e.userId,s=`${t}-assignments`,a=global.cache.get(s);if(a&&new Date().getTime()<a.expires)return a.data;let i=await getAssignments({lectioCookies:e.lectioCookies,schoolCode:e.schoolCode}),n=processResult(i);validateResult(n);let l="success"===n.status?n.data:null;return l&&global.cache.set(s,{data:l,expires:new Date().getTime()+getTimeInMs({minutes:5})}),l};function setInformationProps(e,t){e("div#m_Content_registerAfl_pa > table > tbody > tr").map((s,a)=>{let i=e(a),n=i.find("td"),l=c[i.find("th").text()];if("title"===l)t.title=n.find("span").text();else if("documents"===l)n.find("a").each((s,a)=>{let i=e(a),n=i.text().trim(),l=n.split("."),[r,...o]=l[l.length-1].split(" ");r=`.${r}`;let c=o.join(" ");c=` ${c}`||"",l.pop();let d=[[...l].join("."),c,r].join(""),u=t.documents.push({name:d,href:""}),g=i.attr("href");g&&(t.documents[u-1].href=g)});else if("note"===l){t.description=n.text().split("\n");for(let e=0;e<t.description.length;e++)t.description[e]=t.description[e].replace(/\s{2,}/g," ")}else if("class"===l)t.subject=getSubjectName(n.find("span").text()),t.class=n.find("span").text().split(" ")[0];else if("gradeSystem"===l)t.gradeSystem=n.find("span").text();else if("teacher"===l){let e=n.find("span").text().split(" ("),s=e[0],a=e[1].replace(")","");t.teacher.name=s,t.teacher.initials=a}else if("studentTime"===l){let e=n.find("span").text().split(" ")[0];isNaN(Number(e))||(t.studentTime=Number(e))}else if("dueTo"===l){let e=n.text();t.dueTo=e}else if("inTeachingDescription"===l){let e="Ja"===n.text();t.inTeachingDescription=e}})}function setAdditionalProps(e,t){e("table#m_Content_StudentGV > tbody > tr:nth-child(2) > td").each((s,a)=>{let i=e(a);if(2===s){let e=i.text()||"Ingen";t.awaiter=e}else if(3===s){let e=i.find("span").text().split("/"),s=e[0].trim().replace("Ikke aflev.","Ikke afleveret"),a=e[1].trim().split(" ")[1];t.status=s,t.absence=a}else if(4===s){let e=i.find("span > input").attr("checked");e&&"checked"===e&&(t.finished=!0)}else if(5===s){let e=i.text().trim();t.grade=e}else if(6===s){let e=i.text().trim();t.gradeNote=e}else if(7===s){let e=i.text().trim();t.studentNote=e}})}function setSubmitProps(e,t){e("#m_Content_RecipientGV > tbody > tr").each((s,a)=>{let i=e(a);i.text().includes("Der er ingen indl\xe6g!")||(0!==s&&t.submits.push({time:"",submitter:"",comment:"",document:{name:"",href:""}}),i.find("td").each((a,i)=>{let n=e(i);if(0===a){let e=n.text();t.submits[s-1].time=e}else if(1===a){let e=n.find("span").text();t.teacher.initials.toLowerCase()===e.toLowerCase()?t.submits[s-1].submitter=t.teacher.name:t.submits[s-1].submitter=e}else if(2===a){let e=n.text();t.submits[s-1].comment=e}else if(3===a){let e=n.find("span > a"),a=e.attr("href");a&&(t.submits[s-1].document.name=e.text(),t.submits[s-1].document.href=a)}}))})}let c={"Opgavetitel:":"title","Opgavebeskrivelse:":"documents","Opgavenote:":"note","Hold:":"class","Karakterskala:":"gradeSystem","Ansvarlig:":"teacher","Elevtid:":"studentTime","Afleveringsfrist:":"dueTo","I undervisningsbeskrivelse:":"inTeachingDescription"};async function getAssignment({lectioCookies:e,schoolCode:t,href:s}){let a=await getAuthenticatedPage_getAuthenticatedPage({lectioCookies:e,schoolCode:t,specificPage:s});if("Not authenticated"===a||"Forbidden access"===a||"Invalid school"===a||null===a)return a;let i=a.$,n={studentName:"",title:"",documents:[],description:[],subject:"",class:"",gradeSystem:"",teacher:{name:"",initials:"",teacherId:"",imgSrc:"",imgUrl:""},studentTime:0,dueTo:"",inTeachingDescription:!1,awaiter:"",status:"",absence:"",finished:!1,grade:"",gradeNote:"",studentNote:"",submits:[]},l=i("#MainTitle").text().match(/Eleven ([a-zæøå ]+)\(/i);l&&(n.studentName=l[1].trim()),setInformationProps(i,n),setAdditionalProps(i,n),setSubmitProps(i,n),n.submits=n.submits.reverse();let r=await getTeacherByInitials({lectioCookies:e,schoolCode:t,initials:n.teacher.initials});return"object"==typeof r&&null!==r&&(n.teacher=r),n}let getAssignmentByHref=async e=>{let t=`ElevAflevering.aspx?elevid=${e.userId}&exerciseid=${e.assignmentId}`,s=e.userId,a=`${s}-assignments-${e.assignmentId}`,i=global.cache.get(a);if(i&&new Date().getTime()<i.expires)return i.data;let n=await getAssignment({href:t,lectioCookies:e.lectioCookies,schoolCode:e.schoolCode}),l=processResult(n);validateResult(l);let r="success"===l.status?l.data:null;return r&&global.cache.set(a,{data:r,expires:new Date().getTime()+getTimeInMs({minutes:1})}),r},d={getSchool:getSchool,getAllSchools:getAllSchools_getAllSchools,getIsAuthenticated:getIsAuthenticated_getIsAuthenticated,getStudent:{byCredentials:getStudentByCredentials_getStudentByCredentials},getSchedule:{byCredentials:getScheduleByCredentials},getAssignment:{all:getAllAssignments,byHref:getAssignmentByHref}}},89113:(e,t,s)=>{s.r(t),s.d(t,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var a=s(46775);let __WEBPACK_DEFAULT_EXPORT__=e=>{let t=(0,a.fillMetadataSegment)(".",e.params,"favicon.ico");return[{type:"image/x-icon",sizes:"16x16",url:t+""}]}}};